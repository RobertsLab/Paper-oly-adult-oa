# pH:Temperature             2  232659102 116329551  3.9901 0.062809 .
# Population:pH:Temperature  9  453645892  50405099  1.7289 0.226205
# Residuals                  8  233233725  29154216
TukeyHSD(aov(total.percap ~ Population*pH*Temperature-pH-Population:pH-Population:Temperature, data=spawning_group_sum))
# Test mean larvae per broodstock, fit models
anova(mean1 <- lm(mean.percap ~Population*pH*Temperature, data=spawning_group_sum))
anova(mean2 <- lm(mean.percap ~Population*pH*Temperature-pH, data=spawning_group_sum))
anova(mean3 <- lm(mean.percap ~Population*pH*Temperature-pH-Population:pH, data=spawning_group_sum))
anova(mean4 <- lm(mean.percap ~Population*pH*Temperature-pH-Population:pH-Population:Temperature, data=spawning_group_sum))
anova(mean5 <- lm(mean.percap ~Population*pH*Temperature-pH-Population:pH-Population:Temperature-Population:pH:Temperature, data=spawning_group_sum))
anova(mean6 <- lm(mean.percap ~Population + pH:Temperature, data=spawning_group_sum))
anova(mean7 <- lm(mean.percap ~Population, data=spawning_group_sum))
anova(mean8 <- lm(mean.percap ~pH, data=spawning_group_sum))
anova(mean9 <- lm(mean.percap ~Temperature, data=spawning_group_sum))
AIC(mean1,mean2,mean3,mean4,mean5,mean6,mean7,mean8,mean9) #1-4 equal. Most parsimonious is mean4.
# Response: mean.percap
#                            Df   Sum Sq Mean Sq F value    Pr(>F)
# Population                 3 15129394 5043131 16.3873 0.0008896 *** <---sign.
# Temperature                1   730910  730910  2.3750 0.1618569
# pH:Temperature             2  3168818 1584409  5.1484 0.0365471 *  <--- sign.
# Population:pH:Temperature  9  4960241  551138  1.7909 0.2119352
# Residuals                  8  2461968  307746
TukeyHSD(mean4 <- aov(mean.percap ~Population*pH*Temperature-pH-Population:pH-Population:Temperature, data=spawning_group_sum))
# Timing- first big release (>10k)
anova(big1 <- lm(first.big ~ Population*Temperature*pH, data=spawning_group_sum))
anova(big2 <- lm(first.big ~ Population*Temperature+Population:pH+Temperature:pH+Population:Temperature+pH:Population:Temperature, data=spawning_group_sum))
anova(big3 <- lm(first.big ~ Population+Temperature+Population:pH+Temperature:pH+pH:Population:Temperature, data=spawning_group_sum))
anova(big4 <- lm(first.big ~ Population+Temperature+Population:pH+pH:Population:Temperature, data=spawning_group_sum))
anova(big5 <- lm(first.big ~ Population+Temperature+Population:pH, data=spawning_group_sum))
anova(big6 <- lm(first.big ~ Population+Temperature, data=spawning_group_sum))
AIC(big1, big2, big3, big4, big5, big6)
summary(big4) #most parsimoneous
# Response: first.big
#                             Df Sum Sq Mean Sq F value   Pr(>F)
# Population                 3 606.71 202.236 15.0501 0.001184 ** <--- sign.
# Temperature                1 160.17 160.167 11.9194 0.008664 ** <--- sign.
# Population:pH              4 185.38  46.344  3.4488 0.064106 .
# Population:Temperature:pH  7 229.58  32.798  2.4408 0.117285
# Residuals                  8 107.50  13.437
TukeyHSD(big4 <- aov(first.big ~ Population+Temperature+Population:pH+pH:Population:Temperature, data=spawning_group_sum))
aggregate(first.big ~ pH:Temperature:Population, data=spawning_group_sum, sum)
aggregate(first.big ~ pH:Temperature:Population, data=spawning_group_sum, mean)
aggregate(first.big ~ Groups, data=spawning_group_sum, mean)
145.8-135.9
# Day of maximum release
anova(max1 <- lm(maxday ~ Population*Temperature*pH, data=spawning_group_sum))
anova(max2 <- lm(maxday ~ Population*Temperature*pH - Population:pH, data=spawning_group_sum))
anova(max3 <- lm(maxday ~ Population*Temperature*pH - Population:pH - Population:Temperature:pH, data=spawning_group_sum))
anova(max4 <- lm(maxday ~ Population*Temperature*pH - Population:pH - Population:Temperature:pH- Population:Temperature, data=spawning_group_sum))
anova(max5 <- lm(maxday ~ Population+Temperature+pH, data=spawning_group_sum))
anova(max6 <- lm(maxday ~ Population+Temperature, data=spawning_group_sum))
anova(max7 <- lm(maxday ~ Temperature, data=spawning_group_sum))
AIC(max1,max2,max3,max4,max5,max6,max7)
anova(max6) #lowest AIC, just Pop + Temp
# Response: maxday
#                Df  Sum Sq Mean Sq F value  Pr(>F)
# Population      3  417.37  139.12  2.2364 0.11708
# Temperature     1  416.67  416.67  6.6979 0.01804 * <--- sign.
# Residuals       19 1181.96   62.21
summary(max6 <- lm(maxday ~ Population+Temperature, data=spawning_group_sum))
# No. release days
anova(lm(release.days ~ Temperature*pH, data=spawning_group_sum))
anova(lm(release.days ~ Population*Temperature*pH, data=subset(spawning_group_sum, Population!="K")))
anova(pulses1 <- lm(release.days ~ Population*Temperature*pH, data=spawning_group_sum))
anova(pulses2 <- lm(release.days ~ Population*Temperature*pH-Population:Temperature:pH, data=spawning_group_sum))
anova(pulses3 <- lm(release.days ~ Population*Temperature*pH-Population:Temperature:pH-Population:pH, data=spawning_group_sum))
anova(pulses4 <- lm(release.days ~ Population*Temperature*pH-Population:Temperature:pH-Population:pH-pH, data=spawning_group_sum))
anova(pulses5 <- lm(release.days ~ Population*Temperature, data=spawning_group_sum)) # Lowest AIC
anova(pulses6 <- lm(release.days ~ Population+Temperature, data=spawning_group_sum))
AIC(pulses1,pulses2,pulses3,pulses4,pulses5,pulses6)
# Response: release.days
#                         Df Sum Sq Mean Sq F value    Pr(>F)
# Population              3 97.875  32.625 13.4710 0.0001209 *** <-- sign.
# Temperature             1 24.000  24.000  9.9097 0.0062217 **  <-- sign.
# Population:Temperature  3 17.375   5.792  2.3914 0.1067488
# Residuals              16 38.750   2.422
# ---
TukeyHSD(test1 <- aov(release.days ~ Population*Temperature, data=spawning_group_sum))
TukeyHSD(test1 <- aov(release.days ~ Population*Temperature, data=subset(spawning_group_sum, Population!="K")))
# Identify peak larval release dates for each treatment (cohorts combined)
# Sum # larvae released by treatment each day
treatment_total <- group_by(larvae, Date, pH, Temperature) %>% dplyr::summarize(daily_total = sum(larvae.per.broodcm, na.rm = T))
hist(treatment_total$daily_total)
# reorder population factors for North->South
spawning_group_sum$Population <- factor(spawning_group_sum$Population, levels=c("NF", "HL", "SN", "K"))
Groups <- levels(larvae$Group)
plot.cohort <- levels(fecundity.pop$Population)
plot.names <- c("Dabob Bay", "Oyster Bay C2", "Fidalgo Bay", "Oyster Bay C1")
larvae.0 <- list()
for (i in 1:length(Groups)) {
larvae.0[[i]] <- as.data.frame(group_by(subset(larvae, Group==Groups[i]), Population, Treatment, Temperature, pH) %>%  complete(Date=min(Date)-1, fill = list(Tot.Larvae=0, total.released=0, larvae.per.broodcm=0)))
}
larvae.0 <- rbind(bind_rows(larvae.0), larvae)
fecundity.pop <- group_by(larvae.0, Population, Temperature, pH) %>% dplyr::mutate(cum.total=cumsum(total.released),cum.percap = cumsum(larvae.per.broodcm),CalDay = as.numeric(format(Date,"%j"))) %>% dplyr::arrange(Date) %>% dplyr::select(Date,CalDay,pH,Temperature, Population,total.released,larvae.per.broodcm,cum.total,cum.percap) %>% mutate(Date = as.Date(Date))
plot.cohort <- levels(fecundity.pop$Population)
plot_list = list()
for (i in 1:4) {
p <- ggplot() +
geom_line(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, color=Temperature:pH), size=1.6) + theme_bw(base_size = 10) + ylab("No. of larvae") + xlab(label="Days in reproductive conditioning") +
labs(title=(plot.names[i])) +
theme(plot.title = element_text(size = 13, hjust=0.08, margin = margin(t = 30, b = 0), colour = "gray30"),
axis.title.y = element_blank(), axis.title.x = element_text(colour="gray30"), axis.text.x = element_text(size=10), axis.text.y = element_text(size=10)) +
scale_x_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) +
scale_y_continuous(label=comma, breaks=scales::pretty_breaks(n = 5)) +
theme(legend.position = "none", legend.text = element_text(colour="gray30", size=14), legend.title = element_text(colour="gray30", size=14),  panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(), panel.border = element_blank(), axis.text.y = element_text(size=10), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
scale_color_manual(name="Temperature/pCO2",values=c('#67a9cf', '#2166ac', '#ef8a62', '#b2182b'), label=c("6°C/Amb", "6°C/High", "10°C/Amb", "10°C/High")) + geom_point(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, fill=Temperature:pH), shape=21, size=2, stroke=.2) + scale_fill_manual(values=c("#d1e5f0","#67a9cf","#fddbc7","#ef8a62"))
plot_list[[i]] <- p
}
# Save plots to pdf. Makes a separate file for each plot.
for (i in 1:4) {
file_name = paste("Figures/cumulative_larvae_", i, ".pdf", sep="")
pdf(file_name, width = 6, height = 3)
print(plot_list[[i]])
dev.off()
}
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
# Mean daily release per adult
pdf(file = "Figures/mean-release.pdf", width = 4.5, height = 5.5)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
dev.off()
spawning_group_sum$pH <- factor(spawning_group_sum$pH, levels=c("Low", "Ambient"))
spawning_group_sum$Temperature <- factor(spawning_group_sum$Temperature, levels=c(10, 6))
# Peak larval release date
pdf(file = "Figures/peak-release.pdf", width = 6, height = 3)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
dev.off()
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55))
spawning_group_sum$Temperature
# Summarize data for each treatment treatment, pulling out key dates and summing/averaging larvae
spawning_group_sum <- spawning_group_total %>% group_by(Population, pH, Temperature, Spawning.Group) %>% dplyr::summarize(overall_Total = sum(total.released, na.rm = T), mean.larvae = mean(total.released,na.rm=T), se.larvae = std.error(total.released,na.rm=T), mean.percap = mean(larvae.per.broodcm,na.rm=T), total.percap = sum(larvae.per.broodcm,na.rm=T), maxday = as.numeric(CalDay[which.max(total.released)]), max = max(total.released), max.percap = max(larvae.per.broodcm), first.big = as.numeric(CalDay[which(total.released > 10000)[1]]), release.days = as.numeric(length(CalDay[total.released > 10000])))
spawning_group_sum
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
spawning_group_sum$pH <- factor(spawning_group_sum$pH, levels=c("Low", "Ambient"))
spawning_group_sum$Temperature <- factor(spawning_group_sum$Temperature, levels=c(10, 6))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
#scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5))
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5))
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
spawning_group_sum$Population
rm(list=ls())         #start script by deleting all objects - clean slate
# Import data, convert groups to date, numeric and factors
larvae <- read.csv("Data/larval-release-data.csv", header = TRUE, na.strings = "n/a", stringsAsFactors = F)
larvae$Date <- as.Date(larvae$Date, "%m/%d/%y")
larvae[c("Vol.counted", "Vol.total", "CountA", "CountB", "CountC", "Larvae.mL", "Tot.Larvae")] <- as.numeric(as.character(unlist(larvae[c("Vol.counted", "Vol.total", "CountA", "CountB", "CountC", "Larvae.mL", "Tot.Larvae")])))
larvae[c("Group", "Spawning.Group", "Population", "Treatment", "Temperature", "pH", "Bucket")] <- lapply(larvae[c("Group", "Spawning.Group", "Population", "Treatment", "Temperature", "pH", "Bucket")], factor)
larvae <- arrange(larvae, Date) %>% mutate(CalDay = format(Date,"%j"))  # Add column with calendar day
# Re-calculate total larvae released to confirm spreadsheet accuracy
larvae$total.released <- round(((rowMeans(larvae[,c("CountA", "CountB", "CountC")], na.rm = TRUE, dims = 1))/larvae$Vol.counted)*larvae$Vol.total, digits = -1)
print(larvae$error <- larvae$total.released - larvae$Tot.Larvae) #looks good, just rounding error
add number of broodstock in each spawning group for normalization
larvae$broodstock <- larvae$Spawning.Group
larvae$broodstock <- gsub("NF-10 Ambient A|NF-6 Ambient A|NF-6 Low B|SN-10 Low A|SN-10 Low B|SN-6 Ambient A|HL-6 Low", 15, larvae$broodstock)
larvae$broodstock <- gsub("NF-10 Ambient B|NF-10 Low A|NF-10 Low B|NF-6 Ambient B|NF-6 Low A|HL-6 Ambient", 14, larvae$broodstock)
larvae$broodstock <- gsub("SN-10 Ambient A|SN-10 Ambient B|SN-6 Low A|SN-6 low A|SN-6 Low B", 17, larvae$broodstock)
larvae$broodstock <- gsub("HL-10 Ambient", 9, larvae$broodstock)
larvae$broodstock <- gsub("SN-6 Ambient B|HL-10 Low", 16, larvae$broodstock)
larvae$broodstock <- gsub("K-10 Ambient", 115, larvae$broodstock)
larvae$broodstock <- gsub("K-10 Low", 111, larvae$broodstock)
larvae$broodstock <- gsub("K-6 Ambient", 117, larvae$broodstock)
larvae$broodstock <- gsub("K-6 Low", 126, larvae$broodstock)
larvae$broodstock <- as.numeric(larvae$broodstock)
#Add mean length for each population for normalization
larvae$mean.length <- larvae$Population
larvae$mean.length <- gsub("NF|SN", 3.6, larvae$mean.length)
larvae$mean.length <- gsub("HL", 3.0, larvae$mean.length)
larvae$mean.length <- gsub("K", 2.2, larvae$mean.length)
larvae$mean.length <- as.numeric(larvae$mean.length)
# Normalize # larvae spawned daily by #broodstock*mean length - result is # larvae per broodstock centimeter
larvae$larvae.per.broodcm <- larvae$total.released/(larvae$broodstock*larvae$mean.length)
# Summary statistics
summarise(larvae, total.by.date = sum(total.released))                                              #total larvae released
summarise(larvae, total.by.date = mean(total.released))                                              #mean larvae released
max(larvae$Tot.Larvae, na.rm=T)
aggregate(Tot.Larvae ~ pH + Temperature, larvae, sum, na.rm=TRUE)/180000                                  #By pH & Temperature
aggregate(Tot.Larvae ~ pH + Temperature + Spawning.Group, larvae, sum, na.rm=TRUE)                      #By population
aggregate(Tot.Larvae ~ Spawning.Group, larvae, sum, na.rm=TRUE)                                     #By population & treatment
aggregate(Tot.Larvae ~ pH + Temperature, larvae, mean, na.rm=TRUE)                                     #Overal daily mean release by population & treatment
aggregate(Tot.Larvae ~ pH + Temperature, larvae, sd, na.rm=TRUE)                                     #Overal daily sd release by population & treatment
aggregate(larvae.per.broodcm ~  pH + Temperature, larvae, sum, na.rm=TRUE)                             #total larvae released by # broodstock
aggregate(larvae.per.broodcm ~ pH + Temperature + Spawning.Group, larvae, sum, na.rm=TRUE)                 #By population & treatment
nrow(subset(larvae, total.released >= 10000))                                                       #Number of times >10k larvae were collected (all grps)
sum(aggregate(broodstock ~ Spawning.Group, subset(larvae), mean)$broodstock)                        #Total # broodstock
# ----- Statistics
# summarize data for each spawning bucket
spawning_group_total <- group_by(larvae, Spawning.Group, Population, Treatment, pH, Temperature) %>% mutate(cum.total=cumsum(total.released),cum.percap = cumsum(larvae.per.broodcm),CalDay = as.numeric(format(Date,"%j"))) %>% arrange(Date) %>% dplyr::select(Date,CalDay,Spawning.Group,Population,Treatment,pH,Temperature,total.released,larvae.per.broodcm,cum.total,cum.percap)
# Summarize data for each treatment treatment, pulling out key dates and summing/averaging larvae
spawning_group_sum <- spawning_group_total %>% group_by(Population, pH, Temperature, Spawning.Group) %>% dplyr::summarize(overall_Total = sum(total.released, na.rm = T), mean.larvae = mean(total.released,na.rm=T), se.larvae = std.error(total.released,na.rm=T), mean.percap = mean(larvae.per.broodcm,na.rm=T), total.percap = sum(larvae.per.broodcm,na.rm=T), maxday = as.numeric(CalDay[which.max(total.released)]), max = max(total.released), max.percap = max(larvae.per.broodcm), first.big = as.numeric(CalDay[which(total.released > 10000)[1]]), release.days = as.numeric(length(CalDay[total.released > 10000])))
# reorder population factors for North->South
spawning_group_sum$Population <- factor(spawning_group_sum$Population, levels=c("NF", "HL", "SN", "K"))
Groups <- levels(larvae$Group)
plot.names <- c("Dabob Bay", "Oyster Bay C2", "Fidalgo Bay", "Oyster Bay C1")
plot.cohort <- levels(fecundity.pop$Population)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
spawning_group_sum$pH <- factor(spawning_group_sum$pH, levels=c("Low", "Ambient"))
spawning_group_sum$Temperature <- factor(spawning_group_sum$Temperature, levels=c(10, 6))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
spawning_group_sum$Population
# Mean daily release per adult
pdf(file = "Figures/mean-release.pdf", width = 4.5, height = 5.5)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
dev.off()
spawning_group_sum$pH <- factor(spawning_group_sum$pH, levels=c("Low", "Ambient"))
spawning_group_sum$Temperature <- factor(spawning_group_sum$Temperature, levels=c(10, 6))
# Peak larval release date
pdf(file = "Figures/peak-release.pdf", width = 6, height = 3)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
dev.off()
# Summarize data for each treatment treatment, pulling out key dates and summing/averaging larvae
spawning_group_sum <- spawning_group_total %>% group_by(Population, pH, Temperature, Spawning.Group) %>% dplyr::summarize(overall_Total = sum(total.released, na.rm = T), mean.larvae = mean(total.released,na.rm=T), se.larvae = std.error(total.released,na.rm=T), mean.percap = mean(larvae.per.broodcm,na.rm=T), total.percap = sum(larvae.per.broodcm,na.rm=T), maxday = as.numeric(CalDay[which.max(total.released)]), max = max(total.released), max.percap = max(larvae.per.broodcm), first.big = as.numeric(CalDay[which(total.released > 10000)[1]]), release.days = as.numeric(length(CalDay[total.released > 10000])))
# reorder population factors for North->South
spawning_group_sum$Population <- factor(spawning_group_sum$Population, levels=c("NF", "HL", "SN", "K"))
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
# Mean daily release per adult
pdf(file = "Figures/mean-release.pdf", width = 4.5, height = 5.5)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=mean.percap, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#d1e5f0','#67a9cf','#fddbc7','#ef8a62'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 14, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=12), axis.title.x = element_text(colour="gray30", size=12), axis.text.x = element_blank(), legend.position = "left", legend.text = element_text(colour="gray30", size=12), legend.title = element_text(colour="gray30", size=12), panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) + guides(color = guide_legend(override.aes = list(size=5.5)), shape = guide_legend(override.aes = list(size=5))) +
ggtitle("Mean larvae released\nper oyster, per day") + ylab("No. larvae") + xlab("Treatment") + scale_y_continuous(label=comma, limits=c(min=0, max=4800))
dev.off()
spawning_group_sum$pH <- factor(spawning_group_sum$pH, levels=c("Low", "Ambient"))
spawning_group_sum$Temperature <- factor(spawning_group_sum$Temperature, levels=c(10, 6))
# Peak larval release date
pdf(file = "Figures/peak-release.pdf", width = 6, height = 3)
ggplot(spawning_group_sum, aes(x=Temperature:pH, y=maxday-100, fill=Temperature:pH)) +
geom_boxplot(width=0.35, position = position_dodge(width = .55)) +
scale_fill_manual(values=c('#ef8a62','#fddbc7','#67a9cf','#d1e5f0'), label=c("6°C / Ambient", "6°C / High", "10°C / Ambient","10°C / High"), name="Treatment") +
geom_point(size=2.75, color="gray20", aes(shape=Population, group=Temperature:pH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +  theme_bw(base_size = 10) +
theme(plot.title = element_text(size = 15, hjust = 0.5, margin = margin(t = 30, b = 0), colour = "gray30"), axis.title.y = element_text(colour="gray30", size=11), axis.text.y = element_blank(), axis.title.x = element_text(colour="gray30", size=11), axis.text.x = element_text(size=11), legend.position = "none",panel.grid.minor = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
ggtitle("Peak larval release day") + ylab("Days in reproductive conditioning") + xlab("Treatment") + scale_y_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) + coord_flip()
dev.off()
# Import deployment latitude and longitude data
locationCords <- read.csv("Data/Population-origin-coordinates.csv", header = T, stringsAsFactors = F) #Import outplant coordinate information
locationCords <- locationCords[order(locationCords$Lat.dec),] #Reorder location coordinates by latittude (south to north)
#marker1 = c("sienna1", "goldenrod1", "steelblue2", "royalblue3") #marker colors for each bay, from south to north
symbols <- c(rep(23, times=7)) #symbol shapes for each bay, south to north
data(nepacLLhigh) #Load set of polygons for the NE Pacific Ocean in high resolution from PBSmapping
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
locationCords
locationCords[c(2,3,6,7),]
#Add points to map
for (i in c(2,3,6,7)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=3.5)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.2)
}
dev.off() #Turn off plotting device
# Create file to save map
# svg(filename = "results/Deployment-map.svg") # uncomment/comment depending on which file type you want
# pdf(file = "Figures/Population-origin-map.pdf", height = 8.5, width = 8.5)
pdf(file = "Figures/Population-origin-map-graphical-absract.pdf", height = 8.5, width = 8.5)
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
#Add points to map
for (i in c(2,3,6,7)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=3.5)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.2)
}
dev.off() #Turn off plotting device
locationCords
symbols
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
#Add points to map
#for (i in c(2,3,6,7)) {
for (i in 1:length(symbols)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=3.5)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.2)
}
# svg(filename = "results/Deployment-map.svg") # uncomment/comment depending on which file type you want
pdf(file = "Figures/Population-origin-map-graphical-absract.pdf", height = 8.5, width = 8.5)
#pdf(file = "Figures/Population-origin-map.pdf", height = 8.5, width = 8.5)
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
#Add points to map
for (i in c(2,3,6,7)) {
#for (i in 1:length(symbols)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=3.8)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.4)
}
# Add legend
# legend("topleft", inset=0.05, legend=rev(locationCords$Site), cex=0.8, pt.cex = 1.5, pt.bg="gray20", bg="gray92", pch=rev(symbols), box.lty=1, box.lwd=1, box.col="black")
dev.off() #Turn off plotting device
# svg(filename = "results/Deployment-map.svg") # uncomment/comment depending on which file type you want
pdf(file = "Figures/Population-origin-map-graphical-absract.pdf", height = 8.5, width = 8.5)
#pdf(file = "Figures/Population-origin-map.pdf", height = 8.5, width = 8.5)
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
#Add points to map
for (i in c(2,3,6,7)) {
#for (i in 1:length(symbols)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=4.0)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.6)
}
# Add legend
# legend("topleft", inset=0.05, legend=rev(locationCords$Site), cex=0.8, pt.cex = 1.5, pt.bg="gray20", bg="gray92", pch=rev(symbols), box.lty=1, box.lwd=1, box.col="black")
dev.off() #Turn off plotting device
# Create file to save map
# svg(filename = "results/Deployment-map.svg") # uncomment/comment depending on which file type you want
pdf(file = "Figures/Population-origin-map-graphical-absract.pdf", height = 8.5, width = 8.5)
#pdf(file = "Figures/Population-origin-map.pdf", height = 8.5, width = 8.5)
# Create base map of coastal WA state
plotMap(nepacLLhigh, xlim = c(-123.4, -121.95), ylim = c(46.95, 48.8), col = "gray92", bg = "gray85", xaxt = "n", yaxt = "n", xlab = "", ylab = "", ann = FALSE) #Create a map with high resolution NE Pacific Ocean data. Remove axes since those will be manually added
# Modify base map
axis(side = 1, at = c(-123, -122.5, -122), labels=c("123°W", "122.5°W", "122°W"), tick = TRUE, col.axis = "grey20") #Add longitude axis
axis(side = 2, at = c(46.5, 47, 47.5, 48, 48.5), labels=c("46.5ºN", "47°N", "47.5°N", "48°N", "48.5°N"), tick = TRUE, col.axis = "grey20") #Add latitude axis
#Add points to map
for (i in c(2,3,6,7)) {
#for (i in 1:length(symbols)) {
points(x = locationCords$Long.dec[i], y = locationCords$Lat.dec[i], pch= symbols[i], add = TRUE, bg="gray20", lwd=2, cex=4.1)
text(x = (locationCords$Long.dec[i]), y = (locationCords$Lat.dec[i]), col="white", labels=locationCords$Population[i], font=1, cex=1.6)
}
# Add legend
# legend("topleft", inset=0.05, legend=rev(locationCords$Site), cex=0.8, pt.cex = 1.5, pt.bg="gray20", bg="gray92", pch=rev(symbols), box.lty=1, box.lwd=1, box.col="black")
dev.off() #Turn off plotting device
Oly.size.summary3
Survival.post
Deploy.data
rm(list=ls())         #start script by deleting all objects - clean slate
# Before running scripts, load all needed packages
list.of.packages <- c("ggplot2", "car", "mvoutlier", "dplyr", "reshape2", "stringr", "plotly", "ggpubr", "ggridges", "HH", "pwr", "reshape2", "rcompanion", "lme4", "plotrix", "grid", "gridExtra", "scales", "MASS", "plyr", "PBSmapping", "betareg", "gplots", "corrplot", "cowplot", "tidyr", "colorspace", "tidyverse", "FSA", "ggpmisc") #add new libraries here
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
# Load all libraries
lapply(list.of.packages, FUN = function(X) {
do.call("require", list(X))
})
source("Analyses/panelcor.R")
Bucket.Densities <- read.csv("Data/Biweekly-counts.csv", header = F, stringsAsFactors = F, na.strings = c("NA", "#DIV/0!", "#VALUE!"))
colnames(Bucket.Densities) <- Bucket.Densities[2,]
Bucket.Densities <- Bucket.Densities[-1:-2,]
View(subset(Bucket.Densities.wide, Temperature==6 & stocked>0))
# NOTES regarding groups with 2 larval buckets initially:
# NF10-Low, started new bucket on 5/24
# NF10-Ambient, started new bucket on 5/25
# NF6-Low, started new bucket on 5/25
# HL10-Low, started new bucket on 5/26
# SN10-Low, started new bucket on 5/26
# SN10-Ambient, started new bucket on 6/4
# As of 6/9, only 1 bucket per treatment group in bucket counts, so on previous screening day (6/5) conjoined all duplicated groups
# After 6/9, used connected 2-bucket flow-through system to remove dead larvae (dead stayed in 1st bucket, live swan and flowed to 2nd bucket).
# Assign bucket numbers to treatment/population groups
Buckets <- c(3,12,8,10,5,7,16,13,19,21,24,23,22,18,17,20,1,9,11,4)
Groups <- c("NF-10 Ambient", "NF-10 Low", "NF-6 Ambient", "NF-6 Low", "SN-10 Ambient", "SN-10 Low", "SN-6 Ambient", "SN-6 Low", "HL-10 Ambient","HL-10 Low", "HL-6 Ambient", "HL-6 Low", "K-10 Ambient", "K-10 Low","K-6 Ambient", "K-6 Low", "SN-6 Low", "SN-10 Low", "SN-10 Ambient", "NF-10 Low")
Group.Buckets <- as.data.frame(cbind(Buckets, Groups)) #combine density data with bucket info
# ---- Reformat density dataframe, laboriously
Bucket.Densities.long <- na.omit(melt(Bucket.Densities[,-2], id.vars = "Date")) #melt into long format
Bucket.Densities.long$variable <- as.character(Bucket.Densities.long$variable)  #convert count info to character
Bucket.Densities.long[,c("Bucket", "Count")] <- str_split_fixed(Bucket.Densities.long$variable, "\\.", 2) #split bucket/count info
Bucket.Densities.long$Bucket <- as.factor(Bucket.Densities.long$Bucket) #Convert bucket to factor
Bucket.Densities.long$Count <- as.factor(Bucket.Densities.long$Count) #counvert count type to factor
Bucket.Densities.long$Date <- as.Date(Bucket.Densities.long$Date, "%m/%d/%y") #convert date to date format
Bucket.Densities.long$value <- as.numeric(Bucket.Densities.long$value) #convert count data to numeric
# add columns to break up factors (temp, pH, population)
Bucket.Densities.long$Group <- Bucket.Densities.long$Bucket
Bucket.Densities.long <- merge(Bucket.Densities.long, Group.Buckets, by.x = "Bucket", by.y = "Buckets", all.x = T, all.y = T)
Bucket.Densities.long$Bucket.group <- as.factor(paste(Bucket.Densities.long$Bucket,Bucket.Densities.long$Groups))
Bucket.Densities.long$Treatment <- as.factor(gsub(".*-","",Bucket.Densities.long$Groups))
Bucket.Densities.long$Population <- as.factor(gsub("\\-.*","",Bucket.Densities.long$Groups))
Bucket.Densities.long[,c("Temperature", "pH")] <- str_split_fixed(Bucket.Densities.long$Treatment, "\\s+", 2)
Bucket.Densities.long[,"Temperature"] <- as.factor(Bucket.Densities.long[,"Temperature"])
Bucket.Densities.long[,"pH"] <- as.factor(Bucket.Densities.long[,"pH"])
Bucket.Densities.long <- subset(Bucket.Densities.long, value != 0)
# Reformat again to wide, with each bucket density from day to day (includes larvae added, removed, over time)
Bucket.Densities.wide <- dcast(Bucket.Densities.long, Bucket+Date+Population+Treatment+Temperature+pH ~ Count, value.var = "value")
Bucket.Densities.wide$survival <- Bucket.Densities.wide$actual/Bucket.Densities.wide$expected # survival = (larvae out / larvae in)
Bucket.Densities.wide$dead <- Bucket.Densities.wide$expected - Bucket.Densities.wide$actual   # dead = (larvae in - larvae out)
Survival.post.c
Deploy.growth.c
Post.mass.c
Deploy.data.c
Deploy.growth.c
Oly.size.summary3.c
Survival.post
Deploy.data
Deploy.growth
Survival
rm(list=ls())         #start script by deleting all objects - clean slate
# Before running scripts, load all needed packages
list.of.packages <- c("ggplot2", "car", "mvoutlier", "dplyr", "reshape2", "stringr", "plotly", "ggpubr", "ggridges", "HH", "pwr", "reshape2", "rcompanion", "lme4", "plotrix", "grid", "gridExtra", "scales", "MASS", "plyr", "PBSmapping", "betareg", "gplots", "corrplot", "cowplot", "tidyr", "colorspace", "tidyverse", "FSA", "ggpmisc") #add new libraries here
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
# Load all libraries
lapply(list.of.packages, FUN = function(X) {
do.call("require", list(X))
})
broodstock.length <- read.csv("Data/broodstock-length-data.csv", header=T, na.strings = NA)
broodstock.length$Length <- as.numeric(as.character(broodstock.length$Length))
broodstock.length$Temperature <- as.factor(as.character(broodstock.length$Temperature))
