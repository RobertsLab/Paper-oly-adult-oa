summary(glm(length.mm ~ SURVIVED, data=Deploy.data.length))
summary(lm(length.mm ~ I(SURVIVED/DEPLOYED), data=Deploy.data.length))
# Does length relate to # oysters in each bag?
plot(y=Deploy.data.length$length.mm, x=Deploy.data.length$SURVIVED/Deploy.data.length$DEPLOYED)
# read in initial shell height data prior to deployment
Oly.size <- read.csv("Data/1yr-offspring-size.csv", header = T, stringsAsFactors = T)
# Extract only pouches that were deployed for initial length
Pre.length.deployed <- melt(Oly.size[Oly.size$BAG %in% Deploy.data$POUCH,][,c(-2,-4,-5,-8)], id.vars = c("BAG", "COHORT", "PH", "SIZE.CLASS"), na.action = na.omit)
Pre.length.deployed$value <- as.numeric(Pre.length.deployed$value)
Pre.length.deployed <- subset(Pre.length.deployed, BAG != "NA" & (value != "NA" & value != "s" & value != ""))
Pre.length.deployed$BAG <- as.factor(Pre.length.deployed$BAG)
Pre.length.mean <- aggregate(value ~ BAG + COHORT + PH + SIZE.CLASS, Pre.length.deployed, mean, na.rm=TRUE)
colnames(Pre.length.mean) <- c("BAG", "COHORT", "PH", "SIZE.CLASS", "PRE.LENGTH")
# Plot initial shell length
ggplot(Pre.length.deployed, aes(x=COHORT:PH, y=value)) + geom_boxplot(aes(fill=PH, colour=COHORT)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + scale_color_manual(values=c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3"), name="Cohort", labels=c("D", "O-2", "F", "O-1")) + labs(title="Juvenile shell height prior to deployment", y=expression("shell height"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")  + geom_point(size=1, aes(group=COHORT:PH), position=position_jitter(width = 0.25))
# Mean initial size by cohort & parental pCO2 (befoe deployment)
aggregate(PRE.LENGTH ~  PH + COHORT, Pre.length.mean, FUN = function(x) c(mean = mean(x), sd = sd(x)))
# Calculate mean final length within each pouch
Deploy.length.mean <- aggregate(length.mm ~ POUCH + PH + BAY + HABITAT + POPULATION + SIZE, Deploy.data.length, mean, na.rm=TRUE)
colnames(Deploy.length.mean) <- c("POUCH", "PH", "BAY", "HABITAT", "POPULATION", "SIZE", "POST.LENGTH")
# Merge pre and post length data
Deploy.growth <- merge(x=Pre.length.mean, y=Deploy.length.mean, by.x="BAG", by.y="POUCH")
Deploy.growth$Growth <- Deploy.growth$POST.LENGTH - Deploy.growth$PRE.LENGTH
# Inspect with plots
plot_list_growth = list()
for (i in 1:4) {
p <- ggplot(subset(Deploy.growth, BAY==bays[i]), aes(x=POPULATION:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height, Bay = ", bays[i], sep=""),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="none")  + geom_point(aes(group=POPULATION:PH.y), position=position_jitter(width = 0.25), size=1.8) + geom_text(aes(label=BAG),hjust=0, vjust=0)
plot_list_growth[[i]] <- p
}
plot_list_growth
plot_list_growth
#Statistics
hist((Deploy.growth$Growth+(-1*(min(Deploy.growth$Growth))+1))) #gamma dist.
Deploy.growth$Growth.t <- (Deploy.growth$Growth+(-1*(min(Deploy.growth$Growth))+1))
# Fit model
Anova(glm.grw.1 <- glm(Growth.t ~ BAY*POPULATION*PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.2 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.3 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.4 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y-BAY:POPULATION,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.5 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y-BAY:POPULATION-BAY,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.6 <- glm(Growth.t ~ POPULATION+POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
AIC(glm.grw.1, glm.grw.2, glm.grw.3, glm.grw.4, glm.grw.5, glm.grw.6)
summary(glm.grw.6)
Anova(glm.grw.6 <- glm(Growth.t ~ POPULATION+POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
summary(glm.grw.6)
ggplot(Deploy.growth, aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
Deploy.growth$BAY
ggplot(subset(Deploy.growth, BAY=="FB" | BAY=="PG"), aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(subset(Deploy.growth, BAY=="SK" | BAY=="CI"), aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(subset(Deploy.growth, BAY=="FB" | BAY=="PG"), aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(subset(Deploy.growth, BAY=="SK" | BAY=="CI"), aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(Deploy.growth, aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
summary(glm.grw.6)
# Plot initial shell length
ggplot(Pre.length.deployed, aes(x=COHORT:PH, y=value)) + geom_boxplot(aes(fill=PH, colour=COHORT)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + scale_color_manual(values=c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3"), name="Cohort", labels=c("D", "O-2", "F", "O-1")) + labs(title="Juvenile shell height prior to deployment", y=expression("shell height"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")  + geom_point(size=1, aes(group=COHORT:PH), position=position_jitter(width = 0.25))
Pre.mass <- subset(Oly.size, TEMP==6 & BAG!="NA")[,c(1:8)]
Post.mass <- subset(Deploy.data, POUCH != "NA" & (POUCH != 167 & POUCH != 12))[,c(1:12)]
Pre.mass <- merge(x=Pre.mass, y=Post.mass[c("POUCH", "DEPLOYED")], by.x = "BAG", by.y="POUCH")
Pre.mass$Mass.pre.per <- Pre.mass$BAG.WEIGHT/Pre.mass$DEPLOYED
Post.mass$Mass.post.per <- Post.mass$MASS.F/Post.mass$SURVIVED
Post.mass$POP.PH.HAB <- droplevels(Post.mass$POP.PH.HAB)
plot(Pre.mass$Mass.pre.per ~ Pre.mass$PH)
plot(Post.mass$Mass.post.per ~ Post.mass$POP.PH.HAB)
Post.mass$BAY.PH.HAB <- as.factor(paste(Post.mass$BAY, Post.mass$PH, Deploy.growth$HABITAT, sep = "."))
Post.mass$PH <- as.factor(Post.mass$PH)
# Compare mean mass per oyster between parental pH, habitat
qqPlot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA")$Mass.post.per)
summary(aov(Mass.post.per ~ PH*HABITAT*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
# Plot mean oyster mass by parental pCO2, bay
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=BAY:PH, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
Pre.mass
Post.mass
plot(Pre.mass$Mass.pre.per ~ Pre.mass$PH)
plot(Post.mass$Mass.post.per ~ Post.mass$POP.PH.HAB)
plot(Post.mass$Mass.post.per ~ Post.mass$POPULATION)
# Plot mean oyster mass by parental pCO2, bay
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=BAY:PH, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
plot(x=Post.mass$SURVIVED, y=Post.mass$Mass.post.per)
plot(x=Post.mass$SURVIVED/Post.mass$DEPLOYED, y=Post.mass$Mass.post.per)
summary(aov(Mass.post.per ~ PH*HABITAT*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ PH*POPULATION*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ PH*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ PH*BAY*POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ PH*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
TukeyHSD(aov(Mass.post.per ~ POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
# Plot mean oyster mass by parental pCO2, bay
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=BAY:PH, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
summary(aov(Mass.post.per ~ PH*BAY, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ PH*BAY*POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
summary(aov(Mass.post.per ~ POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
TukeyHSD(aov(Mass.post.per ~ POPULATION, data=subset(Post.mass, Mass.post.per!="NA" & PH != "NA")))
hist((Deploy.growth$Growth+(-1*(min(Deploy.growth$Growth))+1))) #gamma dist.
Deploy.growth$Growth.t <- (Deploy.growth$Growth+(-1*(min(Deploy.growth$Growth))+1))
# Fit model
Anova(glm.grw.1 <- glm(Growth.t ~ BAY*POPULATION*PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.2 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.3 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.4 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y-BAY:POPULATION,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.5 <- glm(Growth.t ~ BAY*POPULATION*PH.y-BAY:POPULATION:PH.y-PH.y-BAY:POPULATION-BAY,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.6 <- glm(Growth.t ~ POPULATION+POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
AIC(glm.grw.1, glm.grw.2, glm.grw.3, glm.grw.4, glm.grw.5, glm.grw.6)
summary(glm.grw.6)
Anova(glm.grw.6 <- glm(Growth.t ~ POPULATION+POPULATION:PH.y,family=Gamma(link="log"), data=Deploy.growth))
ggplot(Deploy.growth, aes(x=BAY:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(Deploy.growth, aes(x=COHORT:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right")
ggplot(Deploy.growth, aes(x=COHORT:PH.y, y=Growth)) + geom_boxplot(aes(fill=PH.y)) + geom_vline(xintercept = c(2.5, 4.5, 6.5, 10.5, 12.5, 14.5), colour="gray") + geom_vline(xintercept = c(8.5), colour="gray20") + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'), name="pCO2", labels = c("Amb.", "High")) + labs(title=paste("Relative Shell Height"),y=expression("Mean shell height change"), x=expression("Cohort : Parental pH")) + theme(legend.position="right") + geom_point()
# Fit model
Anova(glm.grw.1 <- glm(Growth.t ~ BAY*COHORT*PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.2 <- glm(Growth.t ~ BAY*COHORT*PH.y-BAY:COHORT:PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.3 <- glm(Growth.t ~ BAY*COHORT*PH.y-BAY:COHORT:PH.y-PH.y,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.4 <- glm(Growth.t ~ BAY*COHORT*PH.y-BAY:COHORT:PH.y-PH.y-BAY:COHORT,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.5 <- glm(Growth.t ~ BAY*COHORT*PH.y-BAY:COHORT:PH.y-PH.y-BAY:COHORT-BAY,family=Gamma(link="log"), data=Deploy.growth))
Anova(glm.grw.6 <- glm(Growth.t ~ COHORT+COHORT:PH.y,family=Gamma(link="log"), data=Deploy.growth))
AIC(glm.grw.1, glm.grw.2, glm.grw.3, glm.grw.4, glm.grw.5, glm.grw.6)
summary(glm.grw.6)
Anova(glm.grw.6 <- glm(Growth.t ~ COHORT+COHORT:PH.y,family=Gamma(link="log"), data=Deploy.growth))
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Pre.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Pre.mass, Mass.pre.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Pre.mass, Mass.pre.per!="NA" & PH != "NA"),aes(x=COHORT, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Pre.mass, Mass.pre.per!="NA" & PH != "NA"),aes(x=COHORT, y=Mass.pre.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
Post.mass
Pre.mass
test <- merge(x=Post.mass, y=Pre.mass, by.x="POUCH", by.y="BAG")
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=POPULATION, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
test
test$Mass.post.per-test$Mass.pre.per
test$mass.change <- test$Mass.post.per-test$Mass.pre.per
# Plot change in mean mass
ggplot(subset(test, mass.change!="NA" & PH != "NA"),aes(x=COHORT:PH, y=mass.change, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(test, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(test, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH.y), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(test, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH.y), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
plot(test$mass.change)
hist(test$mass.change)
hist(log(test$mass.change))
hist(log2(test$mass.change))
hist(log10(test$mass.change))
hist(log(test$mass.change))
shapiro.test(log(test$mass.change))
shapiro.test(test$mass.change^2)
shapiro.test(test$mass.change^0.5)
hist(test$mass.change^0.5)
summary(aov(mass.change ~  PH*BAY*COHORT, data=test))
summary(aov(mass.change ~  PH.y*BAY*COHORT, data=test))
summary(aov(mass.change ~  COHORT, data=test))
TukeyHSD(aov(mass.change ~  COHORT, data=test))
# Plot mean oyster mass by parental pCO2, bay
ggplot(subset(Post.mass, Mass.post.per!="NA" & PH != "NA"),aes(x=BAY:PH, y=Mass.post.per, fill=PH)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=POPULATION, group=PH), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Mean mass per oyster (g) after deployment",y=expression("Mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:PH.y:BAY, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH.y), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
Mass.change <- merge(x=Post.mass, y=Pre.mass, by.x="POUCH", by.y="BAG")
Mass.change$mass.change <- Mass.change$Mass.post.per-Mass.change$Mass.pre.per
rm(test)
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:PH.y:BAY, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH.y), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:BAY:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", aes(shape=COHORT, group=PH.y), position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
scale_shape_manual(values=c(15, 17, 19, 8), labels=c("Fidalgo Bay", "Dabob Bay", "Oyster Bay C1", "Oyster Bay C2")) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:BAY:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# is mass related to survival?
plot(x=Mass.change$SURVIVED/Mass.change$DEPLOYED, y=Mass.change$mass.change)
# is mass related to survival?
plot(x=Mass.change$SURVIVED/Mass.change$DEPLOYED.x, y=Mass.change$mass.change)
# Compare mass change among factors
hist(Mass.change$mass.change^0.5)
shapiro.Mass.change(Mass.change$mass.change^0.5)
shapiro.test(Mass.change$mass.change^0.5)
summary(aov(mass.change ~  PH.y*BAY*COHORT, data=Mass.change))
summary(aov(mass.change ~  COHORT, data=Mass.change))
TukeyHSD(aov(mass.change ~  COHORT, data=Mass.change))
aggregate(mass.change ~ COHORT, data=mass.change, mean)
aggregate(mass.change ~ COHORT, data=Mass.change, mean)
summary(aov(mass.change^0.5 ~  PH.y*BAY*COHORT, data=Mass.change)) #cohort sign.
summary(aov(mass.change^0.5 ~  BAY*COHORT, data=Mass.change)) #cohort sign.
summary(aov(mass.change^0.5 ~  BAY+COHORT, data=Mass.change))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT:BAY:PH.y, y=mass.change, fill=PH.y)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=BAY, y=mass.change)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=BAY, y=mass.change, fill=BAY)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0)) + scale_fill_manual(values=c('#d1e5f0', '#67a9cf'))
# Plot change in mean mass
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=BAY, y=mass.change, fill=BAY)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0))
# Plot change in mean mass by bay
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT, y=mass.change, fill=COHORT)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("Parental pCO2, bay") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0))
aggregate(mass.change ~ BAY, data=Mass.change, mean)
TukeyHSD(aov(mass.change^0.5 ~  COHORT, data=Mass.change))
TukeyHSD(aov(mass.change^0.5 ~  COHORT+BAY, data=Mass.change))
TukeyHSD(aov(mass.change^0.5 ~ BAY+COHORT, data=Mass.change))
# Plot change in mean mass by bay
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=COHORT, y=mass.change, fill=COHORT)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("COHORT") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0))
# Plot change in mean mass by bay
ggplot(subset(Mass.change, mass.change!="NA" & PH.y != "NA"),aes(x=BAY, y=mass.change, fill=BAY)) +
geom_boxplot() +
geom_point(size=2.75, color="gray20", position=position_jitterdodge(jitter.width = 0.75, jitter.height = .1, dodge.width = 0.5)) +
labs(title="Change in mean mass per oyster (g)",y=expression("Delta mass/oyster (g)")) +
theme_bw(base_size = 14) + xlab("BAY") +
theme(plot.title = element_text(face = 'bold',size = 20, hjust = 0))
summary(aov(mass.change^0.5 ~  BAY+COHORT, data=Mass.change))
TukeyHSD(aov(mass.change^0.5 ~ BAY+COHORT, data=Mass.change))
aggregate(mass.change ~ BAY, data=Mass.change, mean)
histology
# read in data
histology <- read.csv("Data/histology_data.csv", header=T, stringsAsFactors = T, na.strings = "NA")
# Convert a few columns to factors & relevel
histology$TEMPERATURE <- as.factor(histology$TEMPERATURE)
histology$Female.Stage <- as.factor(histology$Female.Stage)
histology$Male.Stage <- as.factor(histology$Male.Stage)
histology$Sex.redo <- as.factor(histology$Sex.redo)
histology$Sex.redo <- droplevels(histology$Sex.redo, exclude = "")
histology$Sex.redo <- factor(histology$Sex.redo, levels=c("I", "M", "HPM", "H", "HPF", "F"))
histology$Dom.Stage.redo <- as.factor(histology$Dom.Stage.redo)
histology$Dom.Stage.redo <- droplevels(histology$Dom.Stage.redo, exclude = "#N/A")
histology$PCO2 <- factor(histology$PCO2, levels = c("Pre","High","Amb"))
# make an empty dataframe for test statistic results
tests <-  data.frame(test=character(), chisquare=character(), pvalue=numeric(), stringsAsFactors=FALSE)
# Com
CT.domsex.stage.pre <- table(subset(histology, SAMPLING=="FEBRUARY")$TEMPERATURE, subset(histology, SAMPLING=="FEBRUARY")$Dom.Stage.redo)
tests[1,] <- as.vector(unlist(chisq.test(CT.domsex.stage.pre, simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
CT.malestage.pre <- table(subset(histology, SAMPLING=="FEBRUARY")$TEMPERATURE, subset(histology, SAMPLING=="FEBRUARY")$Male.Stage)
tests[2,] <- as.vector(unlist(chisq.test(CT.malestage.pre[,-1], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
CT.femstage.pre <- table(subset(histology, SAMPLING=="FEBRUARY")$TEMPERATURE, subset(histology, SAMPLING=="FEBRUARY")$Female.Stage)
tests[3,] <- as.vector(unlist(chisq.test(CT.femstage.pre[,-1], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#10 vs. 6C: 2.1488 p-value = 0.669
?chisq.test
CT.sex.pre <- table(subset(histology, SAMPLING=="FEBRUARY")$TEMPERATURE, subset(histology, SAMPLING=="FEBRUARY")$Sex.simple)
tests[4,] <- as.vector(unlist(chisq.test(CT.sex.pre, simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
# Prepare contingency tables
CT.sex <- table(histology$PCO2, histology$Sex.simple, histology$TEMPERATURE)
CT.sex.plots <- table(histology$PCO2, histology$Sex.redo, histology$TEMPERATURE)
CT.sex.pop <- table(histology$PCO2, histology$Sex.simple, histology$POPULATION, histology$TEMPERATURE)
CT.sex.pop.plots <- table(histology$PCO2, histology$Sex.redo, histology$POPULATION, histology$TEMPERATURE)
CT.sex.temp <- table(histology$PCO2, histology$Sex.simple, histology$TEMPERATURE)
CT.domsex.stage <- table(histology$PCO2, histology$Dom.Stage.redo, histology$TEMPERATURE)
CT.domsex.stage.pop <- table(histology$PCO2, histology$Dom.Stage.redo, histology$POPULATION, histology$TEMPERATURE)
CT.malestage <- table(histology$PCO2, histology$Male.Stage, histology$TEMPERATURE)
CT.malestage.pop <- table(histology$PCO2, histology$Male.Stage, histology$POPULATION, histology$TEMPERATURE)
CT.femstage <- table(histology$PCO2, histology$Female.Stage, histology$TEMPERATURE)
CT.femstage.pop <- table(histology$PCO2, histology$Female.Stage, histology$POPULATION, histology$TEMPERATURE)
colnames(CT.sex.pop.plots) <- c("Indeterminate", "Male", "Male dominant", "Hermaphroditic", "Female dominant", "Female")
colnames(CT.sex.plots) <- c("Indeterminate", "Male", "Male dominant", "Hermaphroditic", "Female dominant", "Female")
colnames(CT.domsex.stage) <- c("Empty/No Follicles (0)", "Early (1)", "Advanced (2)", "Ripe (3)", "Spawned/Regressing (4)")
# Dominant stage, alpha=0.0083333
tests[5,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-1,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, X-squared= 9.738, p-value = 0.0364
tests[6,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-2,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, X-squared=16.514 p=0.0019
tests[7,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-3,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
tests[8,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-1,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, X-squared=12.458,  p-value = 0.009099
tests[9,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-2,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, X-squared=12.682, p-value = 0.009999
tests[10,] <- as.vector(unlist(chisq.test(CT.domsex.stage[-3,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
# female only, alpha=0.0083333
tests[11,] <- as.vector(unlist(chisq.test(CT.femstage[-1,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, p=0.2185
tests[12,] <- as.vector(unlist(chisq.test(CT.femstage[-2,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, p=0.07639
tests[13,] <- as.vector(unlist(chisq.test(CT.femstage[-3,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
tests[14,] <- as.vector(unlist(chisq.test(CT.femstage[-1,2:4,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, p=1
tests[15,] <- as.vector(unlist(chisq.test(CT.femstage[-2,2:4,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, p=0.1274
tests[16,] <- as.vector(unlist(chisq.test(CT.femstage[-3,2:4,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
# male only, (alpha=0.0083333)
tests[17,] <- as.vector(unlist(chisq.test(CT.malestage[-1,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, X-squared = 8.975, p-value = 0.0297
tests[18,] <- as.vector(unlist(chisq.test(CT.malestage[-2,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, X-squared=24.197, p=9.999e-05
tests[19,] <- as.vector(unlist(chisq.test(CT.malestage[-3,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
tests[20,] <- as.vector(unlist(chisq.test(CT.malestage[-1,-1,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#ambient vs. low, X-squared = 9.5, p-value = 0.0221
tests[21,] <- as.vector(unlist(chisq.test(CT.malestage[-2,-1,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#pre to ambient, X-squared=15.387, p-value = 0.0036
tests[22,] <- as.vector(unlist(chisq.test(CT.malestage[-3,-1,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
# Sex, alpha=0.0083333
tests[23,] <- as.vector(unlist(chisq.test(CT.sex[-1,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#sex btwn ambient and low pH: X-squared=5.3909, p=0.1542
tests[24,] <- as.vector(unlist(chisq.test(CT.sex[-2,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#sex btwn pre and ambient pH: X-squared=
tests[25,] <- as.vector(unlist(chisq.test(CT.sex[-3,,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
tests[26,] <- as.vector(unlist(chisq.test(CT.sex[-1,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#sex btwn ambient and low pH: X-squared=0.62657, p-value = 0.9091
tests[27,] <- as.vector(unlist(chisq.test(CT.sex[-2,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
#sex btwn pre and ambient pH: X-squared=6.8457, p-value = 0.07399
tests[28,] <- as.vector(unlist(chisq.test(CT.sex[-3,,"10"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
CT.domsex.stage <- table(histology$PCO2, histology$Dom.Stage.redo, histology$TEMPERATURE)
tests[29,] <- as.vector(unlist(chisq.test(rbind(CT.domsex.stage[3,,c("6")],CT.domsex.stage[2,,c("10")]), simulate.p.value = T, B=10000)[c("data.name", "statistic", "p.value")])) #X=2.8185, p=0.63
CT.sex <- table(histology$PCO2, histology$Sex.simple, histology$TEMPERATURE)
tests[30,] <- as.vector(unlist(chisq.test(rbind(CT.sex[3,,c("6")],CT.sex[2,,c("10")]), simulate.p.value = T, B=10000)[c("data.name", "statistic", "p.value")]))
CT.malestage <- table(histology$PCO2, histology$Male.Stage, histology$TEMPERATURE)
tests[31,] <- as.vector(unlist(chisq.test(rbind(CT.malestage[3,-1,c("6")],CT.malestage[2,-1,c("10")]), simulate.p.value = T, B=10000)[c("data.name", "statistic", "p.value")]))
CT.femstage <- table(histology$PCO2, histology$Female.Stage, histology$TEMPERATURE)
tests[32,] <- as.vector(unlist(chisq.test(rbind(CT.femstage[3,2:4,c("6")],CT.femstage[2,2:4,c("10")]), simulate.p.value = T, B=10000)[c("data.name", "statistic", "p.value")]))
tests$holm <- p.adjust(tests$pvalue, "holm")
tests$BH <- p.adjust(tests$pvalue, "BH")
View(tests) # review - opting to go with the less conservative, due to many different correlations in data
round(prop.table(CT.malestage[-1,,"6"],1 ), digits = 3)
round(prop.table(CT.malestage[-1,,"10"],1 ), digits = 3)
as.vector(unlist(chisq.test(CT.femstage[-1,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]))
chisq.test(CT.femstage[-1,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")])
chisq.test(CT.femstage[-1,-1,"6"], simulate.p.value = T, B = 10000)[c("data.name", "statistic", "p.value")]
chisq.test(CT.femstage[-1,-1,"6"], simulate.p.value = T, B = 10000)
CT.femstage[-1,-1,"6"]
CT.femstage
CT.femstage
CT.femstage[-1,2:4,"10"]
chisq.test(CT.femstage[-1,2:4,"10"], simulate.p.value = T, B = 10000)
plot_list
plot_list = list()
for (i in 1:4) {
p <- ggplot() +
geom_line(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, color=Temperature:pH), size=1.6) + theme_bw(base_size = 10) + ylab("No. of larvae") + xlab(label="Days in reproductive conditioning") +
labs(title=(plot.names[i])) +
theme(plot.title = element_text(size = 13, hjust=0.08, margin = margin(t = 30, b = 0), colour = "gray30"),
axis.title.y = element_blank(), axis.title.x = element_text(colour="gray30"), axis.text.x = element_text(size=10), axis.text.y = element_text(size=10)) +
scale_x_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) +
scale_y_continuous(label=comma, breaks=scales::pretty_breaks(n = 5)) +
theme(legend.position = "none", legend.text = element_text(colour="gray30", size=14), legend.title = element_text(colour="gray30", size=14),  panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(), panel.border = element_blank(), axis.text.y = element_text(size=10), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
scale_color_manual(name="Temperature/pCO2",values=c('#67a9cf', '#2166ac', '#ef8a62', '#b2182b'), label=c("6°C/Amb", "6°C/High", "10°C/Amb", "10°C/High")) + geom_point(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, fill=Temperature:pH), shape=21, size=2, stroke=.2) + scale_fill_manual(values=c("#d1e5f0","#67a9cf","#fddbc7","#ef8a62"))
plot_list[[i]] <- p
}
fecundity.pop <- group_by(larvae.0, Population, Temperature, pH) %>% dplyr::mutate(cum.total=cumsum(total.released),cum.percap = cumsum(larvae.per.broodcm),CalDay = as.numeric(format(Date,"%j"))) %>% dplyr::arrange(Date) %>% dplyr::select(Date,CalDay,pH,Temperature, Population,total.released,larvae.per.broodcm,cum.total,cum.percap) %>% mutate(Date = as.Date(Date))
larvae.0 <- rbind(bind_rows(larvae.0), larvae)
Groups <- levels(larvae$Group)
plot.names <- c("Dabob Bay", "Oyster Bay C2", "Fidalgo Bay", "Oyster Bay C1")
larvae.0 <- list()
for (i in 1:length(Groups)) {
larvae.0[[i]] <- as.data.frame(group_by(subset(larvae, Group==Groups[i]), Population, Treatment, Temperature, pH) %>%  complete(Date=min(Date)-1, fill = list(Tot.Larvae=0, total.released=0, larvae.per.broodcm=0)))
}
larvae.0 <- rbind(bind_rows(larvae.0), larvae)
fecundity.pop <- group_by(larvae.0, Population, Temperature, pH) %>% dplyr::mutate(cum.total=cumsum(total.released),cum.percap = cumsum(larvae.per.broodcm),CalDay = as.numeric(format(Date,"%j"))) %>% dplyr::arrange(Date) %>% dplyr::select(Date,CalDay,pH,Temperature, Population,total.released,larvae.per.broodcm,cum.total,cum.percap) %>% mutate(Date = as.Date(Date))
plot.cohort <- levels(fecundity.pop$Population)
plot_list = list()
for (i in 1:4) {
p <- ggplot() +
geom_line(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, color=Temperature:pH), size=1.6) + theme_bw(base_size = 10) + ylab("No. of larvae") + xlab(label="Days in reproductive conditioning") +
labs(title=(plot.names[i])) +
theme(plot.title = element_text(size = 13, hjust=0.08, margin = margin(t = 30, b = 0), colour = "gray30"),
axis.title.y = element_blank(), axis.title.x = element_text(colour="gray30"), axis.text.x = element_text(size=10), axis.text.y = element_text(size=10)) +
scale_x_continuous(limits=c(min=28,max=90), breaks = c(28,42,56,70,86)) +
scale_y_continuous(label=comma, breaks=scales::pretty_breaks(n = 5)) +
theme(legend.position = "none", legend.text = element_text(colour="gray30", size=14), legend.title = element_text(colour="gray30", size=14),  panel.grid.minor = element_blank(),
panel.grid.major.x = element_blank(), panel.border = element_blank(), axis.text.y = element_text(size=10), axis.line.x = element_line(color="gray30", size = .2), axis.line.y = element_line(color="gray30", size = .2)) +
scale_color_manual(name="Temperature/pCO2",values=c('#67a9cf', '#2166ac', '#ef8a62', '#b2182b'), label=c("6°C/Amb", "6°C/High", "10°C/Amb", "10°C/High")) + geom_point(data=subset(fecundity.pop, Population == plot.cohort[i]), aes(x=CalDay-101, y=cum.percap, group=Temperature:pH, fill=Temperature:pH), shape=21, size=2, stroke=.2) + scale_fill_manual(values=c("#d1e5f0","#67a9cf","#fddbc7","#ef8a62"))
plot_list[[i]] <- p
}
plot_list
